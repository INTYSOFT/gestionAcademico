<h2 mat-dialog-title>{{ title }}</h2>

<mat-dialog-content [formGroup]="form">
    @if (rangoInvalido) {
        <div class="error-banner">El rango final debe ser mayor o igual al rango inicial.</div>
    }

    <div class="form-grid">
        <mat-form-field appearance="outline">
            <mat-label>Tipo de pregunta</mat-label>
            <mat-select formControlName="evaluacionTipoPreguntaId">
                @for (tipo of evaluacionTipoPreguntas; track tipo.id) {
                    <mat-option [value]="tipo.id">{{ tipo.nombre }}</mat-option>
                }
            </mat-select>
            @if (hasError('evaluacionTipoPreguntaId', 'required')) {
                <mat-error>Selecciona un tipo de pregunta.</mat-error>
            }
        </mat-form-field>

        <mat-form-field appearance="outline">
            <mat-label>Rango inicio</mat-label>
            <input matInput type="number" formControlName="rangoInicio" min="0" />
            @if (hasError('rangoInicio', 'required')) {
                <mat-error>Ingresa el rango inicial.</mat-error>
            }
            @if (hasError('rangoInicio', 'min')) {
                <mat-error>El rango inicial no puede ser negativo.</mat-error>
            }
        </mat-form-field>

        <mat-form-field appearance="outline">
            <mat-label>Rango fin</mat-label>
            <input matInput type="number" formControlName="rangoFin" min="0" />
            @if (hasError('rangoFin', 'required')) {
                <mat-error>Ingresa el rango final.</mat-error>
            }
            @if (hasError('rangoFin', 'min')) {
                <mat-error>El rango final no puede ser negativo.</mat-error>
            }
        </mat-form-field>

        <mat-form-field appearance="outline">
            <mat-label>Valor buena</mat-label>
            <input matInput type="number" step="0.01" formControlName="valorBuena" />
            @if (hasError('valorBuena', 'required')) {
                <mat-error>Ingresa el valor para respuestas buenas.</mat-error>
            }
        </mat-form-field>

        <mat-form-field appearance="outline">
            <mat-label>Valor mala</mat-label>
            <input matInput type="number" step="0.01" formControlName="valorMala" />
            @if (hasError('valorMala', 'required')) {
                <mat-error>Ingresa el valor para respuestas malas.</mat-error>
            }
        </mat-form-field>

        <mat-form-field appearance="outline">
            <mat-label>Valor blanca</mat-label>
            <input matInput type="number" step="0.01" formControlName="valorBlanca" />
            @if (hasError('valorBlanca', 'required')) {
                <mat-error>Ingresa el valor para respuestas en blanco.</mat-error>
            }
        </mat-form-field>

        <mat-form-field appearance="outline" class="form-grid__full">
            <mat-label>Observación</mat-label>
            <textarea
                matInput
                formControlName="observacion"
                rows="3"
                maxlength="500"
            ></textarea>
            @if (hasError('observacion', 'maxlength')) {
                <mat-error>La observación no puede superar 500 caracteres.</mat-error>
            }
        </mat-form-field>

        <mat-slide-toggle formControlName="activo">Activo</mat-slide-toggle>
    </div>
</mat-dialog-content>

<mat-dialog-actions align="end">
    <button mat-button type="button" (click)="cancel()">Cancelar</button>
    <button
        mat-flat-button
        color="primary"
        type="button"
        (click)="save()"
        [disabled]="form.invalid || (isSaving$ | async)"
    >
        Guardar
    </button>
</mat-dialog-actions>

@if (isSaving$ | async) {
    <mat-progress-bar mode="indeterminate"></mat-progress-bar>
}
