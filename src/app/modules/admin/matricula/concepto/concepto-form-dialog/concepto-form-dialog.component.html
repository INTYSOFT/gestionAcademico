<h2 mat-dialog-title>{{ data.concepto ? 'Editar concepto' : 'Nuevo concepto' }}</h2>

<form class="concepto-form" [formGroup]="form" (ngSubmit)="save()">
  <mat-dialog-content class="concepto-form__content">
    @if (isSaving$ | async) {
      <mat-progress-bar
        mode="indeterminate"
      color="primary"></mat-progress-bar>
    }

    <mat-form-field appearance="outline">
      <mat-label>Nombre</mat-label>
      <input matInput formControlName="nombre" maxlength="150" />
      @if (form.get('nombre')?.hasError('required')) {
        <mat-error>
          El nombre es obligatorio.
        </mat-error>
      }
      @if (form.get('nombre')?.hasError('maxlength')) {
        <mat-error>
          Máximo 150 caracteres permitidos.
        </mat-error>
      }
    </mat-form-field>

    <div class="concepto-form__row">
      <mat-form-field appearance="outline">
        <mat-label>Precio</mat-label>
        <input
          matInput
          type="number"
          formControlName="precio"
          min="0"
          step="0.01"
          inputmode="decimal" />
          @if (form.get('precio')?.hasError('required')) {
            <mat-error>
              El precio es obligatorio.
            </mat-error>
          }
          @if (form.get('precio')?.hasError('pattern')) {
            <mat-error>
              Ingrese un monto válido con hasta dos decimales.
            </mat-error>
          }
          @if (form.get('precio')?.hasError('min')) {
            <mat-error>
              El precio debe ser mayor o igual a 0.
            </mat-error>
          }
          @if (form.get('precio')?.hasError('max')) {
            <mat-error>
              El precio excede el límite permitido.
            </mat-error>
          }
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Impuesto (%)</mat-label>
          <input
            matInput
            type="number"
            formControlName="impuesto"
            min="0"
            max="100"
            step="0.01"
            inputmode="decimal" />
            <mat-hint>Opcional</mat-hint>
            @if (form.get('impuesto')?.hasError('pattern')) {
              <mat-error>
                Ingrese un valor válido con hasta dos decimales.
              </mat-error>
            }
            @if (form.get('impuesto')?.hasError('min')) {
              <mat-error>
                El impuesto no puede ser negativo.
              </mat-error>
            }
            @if (form.get('impuesto')?.hasError('max')) {
              <mat-error>
                El impuesto no puede ser mayor a 100.
              </mat-error>
            }
          </mat-form-field>
        </div>

        <mat-form-field appearance="outline">
          <mat-label>Tipo de concepto</mat-label>
          <mat-select formControlName="conceptoTipoId">
            <mat-option [value]="null">Sin asignar</mat-option>
            @for (tipo of conceptoTipos; track trackByConceptoTipo($index, tipo)) {
              <mat-option [value]="tipo.id">
                {{ tipo.nombre }}
              </mat-option>
            }
          </mat-select>
        </mat-form-field>

        <mat-slide-toggle color="primary" formControlName="activo">
          {{ form.get('activo')?.value ? 'Activo' : 'Inactivo' }}
        </mat-slide-toggle>
      </mat-dialog-content>

      <mat-dialog-actions align="end">
        <button mat-button type="button" (click)="cancel()" [disabled]="isSaving$ | async">Cancelar</button>
        <button mat-flat-button color="primary" type="submit" [disabled]="isSaving$ | async">
          Guardar
        </button>
      </mat-dialog-actions>
    </form>
