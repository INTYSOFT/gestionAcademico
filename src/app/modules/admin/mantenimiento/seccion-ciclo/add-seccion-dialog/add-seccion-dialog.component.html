<h2 mat-dialog-title>Agregar sección al ciclo</h2>

@if (isSaving$ | async) {
  <mat-progress-bar
    mode="indeterminate"
  color="primary"></mat-progress-bar>
}

<mat-dialog-content>
  @if (hasAvailableSecciones()) {
    <form class="add-seccion-dialog__form" [formGroup]="form">
      <mat-form-field appearance="outline">
        <mat-label>Sección</mat-label>
        <mat-select formControlName="seccionId" placeholder="Seleccionar sección">
          @for (seccion of availableSecciones; track seccion) {
            <mat-option [value]="seccion.id">
              {{ seccion.nombre }} (Capacidad: {{ seccion.capacidad }})
            </mat-option>
          }
        </mat-select>
        @if (form.get('seccionId')?.hasError('required')) {
          <mat-error>
            Selecciona una sección.
          </mat-error>
        }
      </mat-form-field>
      <mat-form-field appearance="outline">
        <mat-label>Nivel</mat-label>
        <mat-select formControlName="nivelId" placeholder="Seleccionar nivel">
          @for (nivel of niveles; track nivel) {
            <mat-option [value]="nivel.id">
              {{ nivel.nombre }}
            </mat-option>
          }
        </mat-select>
        @if (form.get('nivelId')?.hasError('required')) {
          <mat-error>
            Selecciona un nivel.
          </mat-error>
        }
      </mat-form-field>
      <mat-form-field appearance="outline">
        <mat-label>Capacidad</mat-label>
        <input
          matInput
          type="number"
          min="0"
          formControlName="capacidad"
          placeholder="Capacidad de la sección" />
          @if (form.get('capacidad')?.hasError('required')) {
            <mat-error>
              La capacidad es obligatoria.
            </mat-error>
          }
          @if (form.get('capacidad')?.hasError('min')) {
            <mat-error>
              La capacidad no puede ser negativa.
            </mat-error>
          }
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Precio</mat-label>
          <input
            matInput
            type="number"
            min="0"
            step="0.01"
            formControlName="precio"
            placeholder="Precio de la sección" />
            @if (form.get('precio')?.hasError('required')) {
              <mat-error>
                El precio es obligatorio.
              </mat-error>
            }
            @if (form.get('precio')?.hasError('min')) {
              <mat-error>
                El precio no puede ser negativo.
              </mat-error>
            }
          </mat-form-field>
        </form>
      } @else {
        <p class="add-seccion-dialog__empty">
          Todas las secciones disponibles ya se encuentran registradas en este ciclo.
        </p>
      }

    </mat-dialog-content>

    <mat-dialog-actions align="end">
      <button mat-button type="button" (click)="cancel()">Cancelar</button>
      <button
        mat-flat-button
        color="primary"
        type="button"
        (click)="save()"
        [disabled]="(form.invalid && hasAvailableSecciones()) || (isSaving$ | async) || !hasAvailableSecciones()">
        Guardar
      </button>
    </mat-dialog-actions>
