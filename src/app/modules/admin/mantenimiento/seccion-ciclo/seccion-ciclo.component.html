<div class="flex min-w-0 flex-auto flex-col">
  <div class="flex-auto p-6 sm:p-10">
    <section class="seccion-ciclo">
      <header class="seccion-ciclo__header">
        <mat-form-field
          appearance="outline"
          class="seccion-ciclo__field seccion-ciclo__field--sede">
          <mat-label>Seleccionar sede</mat-label>
          <mat-select [formControl]="selectedSedeControl" placeholder="Sede">
            @for (sede of sedes$ | async; track trackBySedeId($index, sede)) {
              <mat-option
                [value]="sede.id">
                {{ sede.nombre }}
              </mat-option>
            }
          </mat-select>
        </mat-form-field>

        <mat-form-field
          appearance="outline"
          class="seccion-ciclo__field seccion-ciclo__field--ciclo">
          <mat-label>Seleccionar ciclo</mat-label>
          <mat-select [formControl]="selectedCicloControl" placeholder="Ciclo">
            @for (ciclo of ciclos$ | async; track trackByCicloId($index, ciclo)) {
              <mat-option
                [value]="ciclo.id">
                {{ ciclo.nombre }}
              </mat-option>
            }
          </mat-select>
        </mat-form-field>

        <button
          mat-raised-button
          color="primary"
          type="button"
          class="seccion-ciclo__new-button"
          (click)="openAddSeccionDialog()"
          [disabled]="!canCreateSeccion()">
          <mat-icon>add</mat-icon>
          Agregar secci√≥n
        </button>
      </header>

      @if (
        (isLoadingSedes$ | async) ||
        (isLoadingCiclos$ | async) ||
        (isLoadingSeccionCiclos$ | async) ||
        (isLoadingCatalogs$ | async)
        ) {
        <mat-progress-bar
          mode="indeterminate"
        color="primary"></mat-progress-bar>
      }

      @if ((sedes$ | async)?.length) {
        @if ((ciclos$ | async)?.length) {
          <ag-grid-angular
            class="ag-theme-material seccion-ciclo__grid"
            [theme]="'legacy'"
            [rowData]="seccionCiclosView$ | async"
            [columnDefs]="columnDefs"
            [defaultColDef]="defaultColDef"
            [animateRows]="true"
            [domLayout]="'autoHeight'"
          (gridReady)="onGridReady($event)"></ag-grid-angular>
          @if (
            !(isLoadingSeccionCiclos$ | async) &&
            !(seccionCiclosView$ | async)?.length
            ) {
            <p
              class="seccion-ciclo__empty"
              >
              No se encontraron secciones registradas para el ciclo seleccionado.
            </p>
          }
        } @else {
          <p class="seccion-ciclo__empty">
            No hay ciclos activos registrados para la sede seleccionada.
          </p>
        }
      } @else {
        <p class="seccion-ciclo__empty">
          No hay sedes registradas. Registra una sede para comenzar a gestionar secciones por ciclo.
        </p>
      }

    </section>
  </div>
</div>
